import unittest
import ConfigParser
import sys
import os
from marauder.settings_parser import SettingsParser
import tempfile

settings_text ='''
[CA]
tpoz: "tpoz here"
AMQ: "AMQ here"
LI:" LI here"
CI:" CI here"
solr_proxy: "solr_proxy here"
solr_server: "solr_server here"

[LM]
tpoz: "LM tpoz"
AMQ: "LM AMQ here"
LI:" LI here"
CI:" CI here"
solr_proxy: "solr_proxy here"
solr_server: "solr_server here"'''

zone_text = '''
[zone]
zone: CA '''

class ParserTest(unittest.TestCase):

    def setUp(self):
       tmp_dir = tempfile.mkdtemp()
       print tmp_dir
       os.environ['LRMS_SETTINGS_PATH'] = tmp_dir
       settings_file = open(tmp_dir + "/settings.ini", "w+")
       settings_file.write(settings_text)
       settings_file.close()
       zone_file = open(tmp_dir + "/zone.ini", "w+")
       zone_file.write(zone_text)
       zone_file.close()
       self.parser = SettingsParser() 

    def test_specific_attr(self):
        self.assertRaises(ConfigParser.NoOptionError, self.parser.get_attr, "name", "CA")
        self.assertRaises(ConfigParser.NoSectionError, self.parser.get_attr, "LI", "DF")
        self.assertRaises(ConfigParser.NoOptionError, self.parser.get_attr, "name")
        self.assertEqual('"tpoz here"', self.parser.get_attr("tpoz"))
        self.assertEqual('"LM tpoz"', self.parser.get_attr("tpoz", "LM"))

    def test_get_all(self):
        self.assertRaises(ConfigParser.NoSectionError, self.parser.get_all_attr, "DF")
    
    def test_zone(self):
        self.assertEqual('CA', self.parser.get_zone())     

if __name__ == '__main__':
    unittest.main()
